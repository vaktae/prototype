<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Games | EcoLearn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@400;700;900&display=swap');
        body {
            font-family: 'Orbitron', monospace;
            background: 
                linear-gradient(45deg, #0d4f3c 0%, #1a6b4f 25%, #2d8f5f 50%, #1a6b4f 75%, #0d4f3c 100%),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="pixel" x="0" y="0" width="10" height="10" patternUnits="userSpaceOnUse"><rect width="10" height="10" fill="%230d4f3c"/><rect width="5" height="5" fill="%231a6b4f"/><rect x="5" y="5" width="5" height="5" fill="%231a6b4f"/></pattern></defs><rect width="100" height="100" fill="url(%23pixel)"/></svg>');
            background-size: 100% 100%, 20px 20px;
            color: #f5f5f5;
            image-rendering: pixelated;
        }
        .game-card {
            background: linear-gradient(145deg, rgba(13, 79, 60, 0.8), rgba(26, 107, 79, 0.6));
            border: 2px solid #2d8f5f;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        .game-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            border-color: #2d8f5f;
        }
        .game-icon {
            background: linear-gradient(135deg, #2d8f5f, #1a6b4f);
        }
        .drag-game-container {
            background: linear-gradient(145deg, rgba(13, 79, 60, 0.8), rgba(26, 107, 79, 0.6));
            border: 2px solid #2d8f5f;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        .draggable-item {
            background: linear-gradient(135deg, #2d8f5f, #1a6b4f);
            border: 2px solid #2d8f5f;
            cursor: grab;
            transition: all 0.3s ease;
        }
        .draggable-item:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(45, 143, 95, 0.3);
        }
        .draggable-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }
        .drop-zone {
            border: 2px dashed #4b5563;
            background: rgba(75, 85, 99, 0.1);
            transition: all 0.3s ease;
            min-height: 60px;
        }
        .drop-zone.drag-over {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }
        .drop-zone.correct {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.2);
        }
        .drop-zone.incorrect {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.2);
        }
        .xp-badge {
            animation: xpPop 0.5s ease-out;
        }
        @keyframes xpPop {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .glow-btn { box-shadow: 0 0 15px rgba(45, 143, 95, 0.5); border: 2px solid #2d8f5f; }
    </style>
</head>
<body class="min-h-screen">
    
    
    <!-- Navigation -->
    <nav class="bg-black bg-opacity-80 backdrop-blur-md fixed w-full z-50 border-b border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <a href="index.html" class="text-2xl font-bold bg-gradient-to-r from-blue-500 to-purple-600 bg-clip-text text-transparent">EcoLearn</a>
                    </div>
                    <div class="hidden md:block">
                        <div class="ml-10 flex items-baseline space-x-4">
                            <a href="index.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Home</a>
                            <a href="games.html" class="text-white px-3 py-2 rounded-md text-sm font-medium"><i data-feather="gamepad-2" class="w-4 h-4 mr-1 inline"></i> Games</a>
                            <a href="profile.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium"><i data-feather="user" class="w-4 h-4 mr-1 inline"></i> Profile</a>
                            <a href="leaderboard.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Leaderboard</a>
                        </div>
                    </div>
                </div>
                <div class="hidden md:block">
                    <div class="ml-4 flex items-center md:ml-6">
                        <div class="ml-3 relative">
                            <div class="flex items-center space-x-2">
                                <span class="text-sm font-medium">XP: <span id="xp-home">0</span></span>
                                <span class="text-sm font-medium text-yellow-400">Level: <span id="level-home">1</span></span>
                                <a href="profile.html"><img class="h-8 w-8 rounded-full" src="http://static.photos/people/200x200/1" alt="Profile"></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="-mr-2 flex md:hidden">
                    <button type="button" class="bg-gray-900 inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-800 focus:outline-none" aria-controls="mobile-menu" aria-expanded="false">
                        <i data-feather="menu"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile menu -->
        <div class="md:hidden hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="index.html" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Home</a>
                <a href="games.html" class="text-white block px-3 py-2 rounded-md text-base font-medium">Games</a>
                <a href="profile.html" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Profile</a>
                <a href="leaderboard.html" class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Leaderboard</a>
            </div>
            <div class="pt-4 pb-3 border-t border-gray-700">
                <div class="flex items-center px-5">
                    <div class="flex-shrink-0">
                        <img class="h-10 w-10 rounded-full" src="http://static.photos/people/200x200/1" alt="Profile">
                    </div>
                    <div class="ml-3">
                        <div class="text-base font-medium text-white">Guest</div>
                        <div class="text-sm font-medium text-gray-400">Level <span id="mobile-level">1</span></div>
                    </div>
                </div>
                <div class="mt-3 px-2 space-y-1">
                    <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-gray-400 hover:text-white hover:bg-gray-700">XP: <span id="mobile-xp">0</span></a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Games Section -->
    <div class="pt-24 pb-12 px-4 sm:px-6 lg:px-8 max-w-6xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-12" data-aos="fade-down">
            <h1 class="text-4xl font-extrabold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-amber-600 via-green-500 to-sky-400" style="font-family: 'Press Start 2P', monospace;">🎮 EcoLearn Games</h1>
            <p class="text-green-300 text-sm" style="font-family: 'Press Start 2P', monospace;">Choose your favorite game and start earning XP!</p>
        </div>

        <!-- Game Selection -->
        <div id="game-selection" class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Quiz Game -->
            <div class="game-card rounded-xl p-8 text-center cursor-pointer" data-aos="fade-up" data-aos-delay="100" onclick="startGame('quiz')">
                <div class="game-icon w-20 h-20 mx-auto mb-6 rounded-full flex items-center justify-center">
                    <i data-feather="help-circle" class="text-white w-10 h-10"></i>
                </div>
                <h3 class="text-2xl font-bold mb-4">Quiz Challenge</h3>
                <p class="text-gray-300 mb-6">Test your knowledge with multiple choice questions about hygiene and health.</p>
                <div class="space-y-2 text-sm" style="font-family: 'Press Start 2P', monospace;">
                    <div class="text-green-300">+10 XP per correct answer</div>
                    <div class="text-gray-400">10 questions per round</div>
                    <div class="text-gray-400">Multiple choice format</div>
                </div>
                <div class="mt-6">
                    <button class="w-full px-6 py-3 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition-colors glow-btn" style="font-family: 'Press Start 2P', monospace;">
                        Start Quiz
                    </button>
                </div>
            </div>

            <!-- Puzzles Game -->
            <div class="game-card rounded-xl p-8 text-center cursor-pointer" data-aos="fade-up" data-aos-delay="200" onclick="startGame('puzzles')">
                <div class="game-icon w-20 h-20 mx-auto mb-6 rounded-full flex items-center justify-center">
                    <i data-feather="puzzle" class="text-white w-10 h-10"></i>
                </div>
                <h3 class="text-2xl font-bold mb-4">Eco Puzzles</h3>
                <p class="text-gray-300 mb-6">Solve riddles and puzzles about hygiene and environmental topics.</p>
                <div class="space-y-2 text-sm" style="font-family: 'Press Start 2P', monospace;">
                    <div class="text-green-300">+15-20 XP per puzzle</div>
                    <div class="text-gray-400">5 puzzles per category</div>
                    <div class="text-gray-400">Text input format</div>
                </div>
                <div class="mt-6">
                    <button class="w-full px-6 py-3 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition-colors glow-btn" style="font-family: 'Press Start 2P', monospace;">
                        Start Puzzles
                    </button>
                </div>
            </div>

            <!-- Drag & Drop Game -->
            <div class="game-card rounded-xl p-8 text-center cursor-pointer" data-aos="fade-up" data-aos-delay="300" onclick="startGame('dragdrop')">
                <div class="game-icon w-20 h-20 mx-auto mb-6 rounded-full flex items-center justify-center">
                    <i data-feather="move" class="text-white w-10 h-10"></i>
                </div>
                <h3 class="text-2xl font-bold mb-4">Drag & Drop</h3>
                <p class="text-gray-300 mb-6">Drag the correct items to their proper places in hygiene scenarios.</p>
                <div class="space-y-2 text-sm" style="font-family: 'Press Start 2P', monospace;">
                    <div class="text-green-300">+25 XP per correct match</div>
                    <div class="text-gray-400">Interactive gameplay</div>
                    <div class="text-gray-400">Visual learning</div>
                </div>
                <div class="mt-6">
                    <button class="w-full px-6 py-3 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition-colors glow-btn" style="font-family: 'Press Start 2P', monospace;">
                        Start Drag & Drop
                    </button>
                </div>
            </div>
        </div>

        <!-- Drag & Drop Game Container -->
        <div id="dragdrop-game" class="hidden">
            <div class="drag-game-container rounded-xl p-8 mb-6" data-aos="fade-up">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 id="drag-game-title" class="text-2xl font-bold mb-2">Hygiene Sorting Challenge</h2>
                        <p id="drag-game-description" class="text-gray-300">Drag the items to their correct categories</p>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-gray-400">Level <span id="current-drag-level">1</span> of <span id="total-drag-levels">3</span></div>
                        <div class="text-sm text-purple-400">+<span id="drag-xp">25</span> XP per match</div>
                    </div>
                </div>

                <!-- Game Area -->
                <div id="drag-game-area" class="flex flex-col lg:flex-row gap-8">
                    <!-- Items to drag - Left side -->
                    <div class="flex-1">
                        <h3 class="text-lg font-semibold mb-4 text-center">Drag Items Here</h3>
                        <div id="drag-items" class="grid grid-cols-2 md:grid-cols-3 gap-4">
                            <!-- Draggable items will be inserted here -->
                        </div>
                    </div>

                    <!-- Drop zones - Right side -->
                    <div class="lg:w-1/2">
                        <h3 class="text-lg font-semibold mb-4 text-center">Drop Zones</h3>
                        <div id="drop-zones" class="space-y-4">
                            <!-- Drop zones will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Game Controls -->
                <div class="flex justify-center space-x-4 mt-8">
                    <button id="check-answers" class="px-6 py-3 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition-colors glow-btn" style="font-family: 'Press Start 2P', monospace;">
                        Check Answers
                    </button>
                    <button id="next-drag-level" class="px-6 py-3 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition-colors hidden glow-btn" style="font-family: 'Press Start 2P', monospace;">
                        Next Level
                    </button>
                    <button id="restart-drag-game" class="px-6 py-3 bg-gray-600 text-white font-medium rounded-lg hover:bg-gray-700 transition-colors glow-btn" style="font-family: 'Press Start 2P', monospace;">
                        Restart
                    </button>
                </div>

                <!-- Feedback -->
                <div id="drag-feedback" class="hidden mt-6 text-center">
                    <div id="drag-feedback-message" class="text-xl font-semibold mb-4"></div>
                    <div id="drag-xp-earned" class="xp-badge inline-block bg-purple-600 text-white px-4 py-2 rounded-full text-sm font-bold mb-4"></div>
                </div>
            </div>

            <!-- Back to Games -->
            <div class="text-center">
                <button onclick="showGameSelection" class="px-6 py-3 bg-gray-700 text-white font-medium rounded-lg hover:bg-gray-600 transition-colors glow-btn" style="font-family: 'Press Start 2P', monospace;">
                    <i data-feather="arrow-left" class="mr-2"></i> Back to Games
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-black py-8 border-t border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-gray-400 text-sm">
                &copy; 2025 EcoLearn For SIH
            </p>
        </div>
    </footer>

    <script>
        AOS.init();
        feather.replace();
        
        // Mobile menu toggle
        document.querySelector('[aria-controls="mobile-menu"]').addEventListener('click', function() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        });

        // Load stored profile (name and avatar) into header
        (function loadStoredProfileHeader(){
            try {
                const storedName = localStorage.getItem('profileName');
                const storedAvatar = localStorage.getItem('profileAvatar');
                const storedXp = localStorage.getItem('xp');
                const storedLevel = localStorage.getItem('level');
                if (storedAvatar) {
                    document.querySelectorAll('nav img[alt="Profile"]').forEach(img => img.src = storedAvatar);
                }
                if (storedName) {
                    const mobileNameEl = document.querySelector('#mobile-menu .text-base.font-medium.text-white');
                    if (mobileNameEl) mobileNameEl.textContent = storedName;
                }
                // Also sync initial XP/Level display to localStorage
                const xpCounter = document.getElementById('xp-home');
                const levelCounter = document.getElementById('level-home');
                const mobileXp = document.getElementById('mobile-xp');
                const mobileLevel = document.getElementById('mobile-level');
                const xp = storedXp !== null ? parseInt(storedXp, 10) : 0;
                const level = storedLevel !== null ? parseInt(storedLevel, 10) : 1;
                if (xpCounter) xpCounter.textContent = isNaN(xp) ? 0 : xp;
                if (levelCounter) levelCounter.textContent = isNaN(level) ? 1 : level;
                if (mobileXp) mobileXp.textContent = isNaN(xp) ? 0 : xp;
                if (mobileLevel) mobileLevel.textContent = isNaN(level) ? 1 : level;
            } catch (e) { /* ignore */ }
        })();

        

        // Game navigation functions
        function startGame(gameType) {
            if (gameType === 'quiz') {
                window.location.href = 'quiz.html';
            } else if (gameType === 'puzzles') {
                window.location.href = 'puzzles.html';
            } else if (gameType === 'dragdrop') {
                showDragDropGame();
            }
        }

        function showGameSelection() {
            document.getElementById('game-selection').classList.remove('hidden');
            document.getElementById('dragdrop-game').classList.add('hidden');
        }

        function showDragDropGame() {
            document.getElementById('game-selection').classList.add('hidden');
            document.getElementById('dragdrop-game').classList.remove('hidden');
            initDragDropGame();
        }

        // Drag & Drop Game Data
        const dragDropLevels = [
            {
                title: "Hygiene Items Sorting",
                description: "Drag the hygiene items to their correct categories",
                items: [
                    { name: "Toothbrush", category: "oral", emoji: "🪥" },
                    { name: "Soap", category: "cleaning", emoji: "🧼" },
                    { name: "Shampoo", category: "cleaning", emoji: "🧴" },
                    { name: "Toothpaste", category: "oral", emoji: "🦷" },
                    { name: "Towel", category: "cleaning", emoji: "🛁" },
                    { name: "Mouthwash", category: "oral", emoji: "💧" }
                ],
                categories: [
                    { name: "Oral Care", key: "oral", emoji: "🦷" },
                    { name: "Cleaning Products", key: "cleaning", emoji: "🧽" }
                ]
            },
            {
                title: "Environmental Actions",
                description: "Match the actions with their environmental impact",
                items: [
                    { name: "Recycling", category: "positive", emoji: "♻️" },
                    { name: "Littering", category: "negative", emoji: "🗑️" },
                    { name: "Planting Trees", category: "positive", emoji: "🌱" },
                    { name: "Using Plastic Bags", category: "negative", emoji: "🛍️" },
                    { name: "Solar Energy", category: "positive", emoji: "☀️" },
                    { name: "Deforestation", category: "negative", emoji: "🌳" }
                ],
                categories: [
                    { name: "Positive Impact", key: "positive", emoji: "✅" },
                    { name: "Negative Impact", key: "negative", emoji: "❌" }
                ]
            },
            {
                title: "Health & Safety",
                description: "Sort items by their health and safety importance",
                items: [
                    { name: "Face Mask", category: "essential", emoji: "😷" },
                    { name: "Hand Sanitizer", category: "essential", emoji: "🧴" },
                    { name: "Candy", category: "optional", emoji: "🍭" },
                    { name: "First Aid Kit", category: "essential", emoji: "🏥" },
                    { name: "Video Game", category: "optional", emoji: "🎮" },
                    { name: "Thermometer", category: "essential", emoji: "🌡️" }
                ],
                categories: [
                    { name: "Essential Items", key: "essential", emoji: "⚕️" },
                    { name: "Optional Items", key: "optional", emoji: "🎯" }
                ]
            }
        ];

        let currentDragLevel = 0;
        let dragScore = 0;
        let draggedItem = null;

        function initDragDropGame() {
            currentDragLevel = 0;
            dragScore = 0;
            loadDragDropLevel();
        }

        function loadDragDropLevel() {
            const level = dragDropLevels[currentDragLevel];
            
            document.getElementById('drag-game-title').textContent = level.title;
            document.getElementById('drag-game-description').textContent = level.description;
            document.getElementById('current-drag-level').textContent = currentDragLevel + 1;
            document.getElementById('total-drag-levels').textContent = dragDropLevels.length;
            
            // Clear previous content
            document.getElementById('drag-items').innerHTML = '';
            document.getElementById('drop-zones').innerHTML = '';
            document.getElementById('drag-feedback').classList.add('hidden');
            document.getElementById('next-drag-level').classList.add('hidden');
            
            // Create draggable items
            level.items.forEach((item, index) => {
                const dragItem = document.createElement('div');
                dragItem.className = 'draggable-item p-3 rounded-lg text-center cursor-grab select-none';
                dragItem.draggable = true;
                dragItem.dataset.itemName = item.name;
                dragItem.dataset.category = item.category;
                dragItem.innerHTML = `
                    <div class="text-xl mb-1">${item.emoji}</div>
                    <div class="text-xs font-medium">${item.name}</div>
                `;
                
                dragItem.addEventListener('dragstart', handleDragStart);
                dragItem.addEventListener('dragend', handleDragEnd);
                
                document.getElementById('drag-items').appendChild(dragItem);
            });
            
            // Create drop zones
            level.categories.forEach(category => {
                const dropZone = document.createElement('div');
                dropZone.className = 'drop-zone p-4 rounded-lg text-center min-h-[120px] flex flex-col justify-center';
                dropZone.dataset.category = category.key;
                dropZone.innerHTML = `
                    <div class="text-2xl mb-2">${category.emoji}</div>
                    <div class="text-base font-semibold mb-1">${category.name}</div>
                    <div class="text-xs text-gray-400">Drop items here</div>
                `;
                
                dropZone.addEventListener('dragover', handleDragOver);
                dropZone.addEventListener('drop', handleDrop);
                dropZone.addEventListener('dragleave', handleDragLeave);
                
                document.getElementById('drop-zones').appendChild(dropZone);
            });
        }

        function handleDragStart(e) {
            draggedItem = e.target;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.outerHTML);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            e.target.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.target.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.target.classList.remove('drag-over');
            
            if (draggedItem) {
                const correctCategory = draggedItem.dataset.category;
                const dropCategory = e.target.dataset.category;
                
                if (correctCategory === dropCategory) {
                    e.target.classList.add('correct');
                    e.target.appendChild(draggedItem);
                    draggedItem.style.pointerEvents = 'none';
                    dragScore++;
                } else {
                    e.target.classList.add('incorrect');
                    setTimeout(() => {
                        e.target.classList.remove('incorrect');
                    }, 1000);
                }
            }
        }

        function checkDragAnswers() {
            const totalItems = dragDropLevels[currentDragLevel].items.length;
            const correctMatches = dragScore;
            const xpEarned = correctMatches * 25;
            
            if (correctMatches === totalItems) {
                document.getElementById('drag-feedback-message').innerHTML = `
                    <div class="text-green-400">🎉 Perfect! All items sorted correctly!</div>
                `;
                document.getElementById('next-drag-level').classList.remove('hidden');
            } else {
                document.getElementById('drag-feedback-message').innerHTML = `
                    <div class="text-yellow-400">Good job! You got ${correctMatches} out of ${totalItems} correct.</div>
                `;
            }
            
            document.getElementById('drag-xp-earned').textContent = `+${xpEarned} XP`;
            document.getElementById('drag-feedback').classList.remove('hidden');
            
            if (xpEarned > 0) {
                updateXP(xpEarned);
            }
        }

        function nextDragLevel() {
            currentDragLevel++;
            if (currentDragLevel < dragDropLevels.length) {
                loadDragDropLevel();
            } else {
                // Game completed
                document.getElementById('drag-game-area').innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">🏆</div>
                        <h3 class="text-3xl font-bold mb-4">Game Complete!</h3>
                        <p class="text-gray-300 mb-6">You've completed all drag & drop levels!</p>
                        <p class="text-yellow-400 text-xl">Total Score: ${dragScore} correct matches</p>
                    </div>
                `;
                document.getElementById('next-drag-level').classList.add('hidden');
            }
        }

        function updateXP(earned) {
            try {
                const currentXp = parseInt(localStorage.getItem('xp') || '0');
                const newXp = currentXp + earned;
                localStorage.setItem('xp', newXp.toString());
                
                // Update display
                const xpCounter = document.getElementById('xp-home');
                const mobileXp = document.getElementById('mobile-xp');
                if (xpCounter) xpCounter.textContent = newXp;
                if (mobileXp) mobileXp.textContent = newXp;
                
                // Update level
                const newLevel = Math.floor(newXp / 100) + 1;
                const levelCounter = document.getElementById('level-home');
                const mobileLevel = document.getElementById('mobile-level');
                if (levelCounter) levelCounter.textContent = newLevel;
                if (mobileLevel) mobileLevel.textContent = newLevel;
                localStorage.setItem('level', newLevel.toString());
            } catch (e) { /* ignore */ }
        }

        // Event listeners
        document.getElementById('check-answers').addEventListener('click', checkDragAnswers);
        document.getElementById('next-drag-level').addEventListener('click', nextDragLevel);
        document.getElementById('restart-drag-game').addEventListener('click', initDragDropGame);
    </script>
</body>
</html>
