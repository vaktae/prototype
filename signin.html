<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In - EcoLearn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@400;700;900&display=swap');
        body {
            font-family: 'Orbitron', monospace;
            background: 
                linear-gradient(45deg, #0d4f3c 0%, #1a6b4f 25%, #2d8f5f 50%, #1a6b4f 75%, #0d4f3c 100%),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="pixel" x="0" y="0" width="10" height="10" patternUnits="userSpaceOnUse"><rect width="10" height="10" fill="%230d4f3c"/><rect width="5" height="5" fill="%231a6b4f"/><rect x="5" y="5" width="5" height="5" fill="%231a6b4f"/></pattern></defs><rect width="100" height="100" fill="url(%23pixel)"/></svg>');
            background-size: 100% 100%, 20px 20px;
            color: #f5f5f5;
            min-height: 100vh;
            image-rendering: pixelated;
        }
        .glass-effect {
            background: rgba(45, 143, 95, 0.2);
            backdrop-filter: blur(5px);
            border: 3px solid #2d8f5f;
            box-shadow: 
                0 0 20px rgba(45, 143, 95, 0.3),
                inset 0 0 20px rgba(26, 107, 79, 0.2);
        }
        .glow-btn {
            box-shadow: 0 0 15px rgba(45, 143, 95, 0.5);
            transition: all 0.3s ease;
            border: 2px solid #2d8f5f;
        }
        .glow-btn:hover {
            box-shadow: 0 0 25px rgba(45, 143, 95, 0.8);
            transform: translateY(-2px);
            background: rgba(45, 143, 95, 0.1);
        }
        .google-btn {
            background: linear-gradient(45deg, #2d8f5f, #1a6b4f);
            color: #fff;
            border: 3px solid #0d4f3c;
            transition: all 0.3s ease;
            font-family: 'Press Start 2P', monospace;
            font-size: 12px;
            text-shadow: 2px 2px 0px #0d4f3c;
        }
        .google-btn:hover {
            background: linear-gradient(45deg, #1a6b4f, #2d8f5f);
            box-shadow: 0 0 20px rgba(45, 143, 95, 0.5);
            transform: translateY(-2px);
        }
        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }
        .shape {
            position: absolute;
            background: linear-gradient(45deg, rgba(45, 143, 95, 0.3), rgba(26, 107, 79, 0.2));
            border: 2px solid #2d8f5f;
            animation: float 6s ease-in-out infinite;
            image-rendering: pixelated;
        }
        .shape::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 4px,
                rgba(45, 143, 95, 0.1) 4px,
                rgba(45, 143, 95, 0.1) 8px
            );
        }
        .shape:nth-child(1) {
            width: 60px;
            height: 80px;
            top: 20%;
            left: 10%;
            animation-delay: 0s;
            border-radius: 0;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }
        .shape:nth-child(2) {
            width: 40px;
            height: 40px;
            top: 60%;
            right: 10%;
            animation-delay: 2s;
            border-radius: 0;
            clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
        }
        .shape:nth-child(3) {
            width: 50px;
            height: 60px;
            bottom: 20%;
            left: 20%;
            animation-delay: 4s;
            border-radius: 0;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center relative">
    <!-- Floating Background Shapes -->
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <!-- Main Content -->
    <div class="relative z-10 w-full max-w-md mx-auto px-4">
        <!-- Logo and Title -->
        <div class="text-center mb-8" data-aos="fade-down">
            <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-green-500 to-green-600 border-4 border-green-400 mb-4 pulse-animation" style="clip-path: polygon(50% 0%, 0% 100%, 100% 100%);">
                <i data-feather="leaf" class="w-10 h-10 text-white"></i>
            </div>
            <h1 class="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-amber-600 via-green-500 to-sky-400 mb-2" style="font-family: 'Press Start 2P', monospace; text-shadow: 3px 3px 0px #0d4f3c;">
                EcoLearn
            </h1>
            <p class="text-green-300 text-sm" style="font-family: 'Press Start 2P', monospace; font-size: 10px;">
                BEGIN YOUR ENVIRONMENTAL ADVENTURE
            </p>
        </div>

        <!-- Sign In Card -->
        <div class="glass-effect rounded-2xl p-8 shadow-2xl" data-aos="fade-up" data-aos-delay="200">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-semibold text-green-400 mb-2" style="font-family: 'Press Start 2P', monospace; font-size: 16px;">SELECT PLAYER</h2>
                <p class="text-green-300 text-sm" style="font-family: 'Press Start 2P', monospace; font-size: 8px;">
                    CHOOSE YOUR ADVENTURE MODE
                </p>
            </div>

            <!-- Google Sign In Button -->
            <div class="mb-6">
                <button 
                    id="google-signin-btn" 
                    class="w-full flex items-center justify-center px-6 py-3 rounded-lg google-btn font-medium text-gray-700 hover:bg-gray-50 transition-all duration-300"
                    onclick="signInWithGoogle()"
                >
                    <svg class="w-5 h-5 mr-3" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    🌱 ECO WARRIOR LOGIN
                </button>
                <button 
                    id="google-popup-btn" 
                    class="w-full flex items-center justify-center px-6 py-3 rounded-lg font-medium transition-all duration-300 mt-2"
                    style="background: linear-gradient(45deg, #1a6b4f, #2d8f5f); color: white; border: 2px solid #0d4f3c; font-family: 'Press Start 2P', monospace; font-size: 10px;"
                    onclick="openGooglePopup()"
                >
                    🔗 OPEN GOOGLE LOGIN
                </button>
                <button 
                    id="test-google-btn" 
                    class="w-full flex items-center justify-center px-6 py-3 rounded-lg font-medium transition-all duration-300 mt-2"
                    style="background: linear-gradient(45deg, #2d8f5f, #1a6b4f); color: white; border: 2px solid #0d4f3c; font-family: 'Press Start 2P', monospace; font-size: 10px;"
                    onclick="testGoogleSignIn()"
                >
                    ⚡ TEST GOOGLE SIGN-IN
                </button>
            </div>

            <!-- Divider -->
            <div class="relative mb-6">
                <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-gray-600"></div>
                </div>
                <div class="relative flex justify-center text-sm">
                    <span class="px-2 bg-gray-900 text-gray-400">or</span>
                </div>
            </div>

            <!-- Guest Mode -->
            <div class="text-center">
                <button 
                    onclick="signInAsGuest()" 
                    class="text-green-400 hover:text-green-300 text-sm font-medium transition-colors duration-300 flex items-center justify-center mx-auto"
                    style="font-family: 'Press Start 2P', monospace; font-size: 10px;"
                >
                    <i data-feather="user" class="w-4 h-4 mr-2"></i>
                    🎮 GUEST EXPLORER
                </button>
                <p class="text-xs text-green-500 mt-2" style="font-family: 'Press Start 2P', monospace; font-size: 6px;">CUSTOMIZE YOUR CHARACTER</p>
            </div>

            <!-- Features Preview -->
            <div class="mt-8 pt-6 border-t border-green-600">
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div class="space-y-2">
                        <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-green-600 border-2 border-green-400 flex items-center justify-center mx-auto" style="clip-path: polygon(50% 0%, 0% 100%, 100% 100%);">
                            <i data-feather="award" class="w-4 h-4 text-white"></i>
                        </div>
                        <p class="text-xs text-green-400" style="font-family: 'Press Start 2P', monospace; font-size: 6px;">ECO XP</p>
                    </div>
                    <div class="space-y-2">
                        <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-green-600 border-2 border-green-400 flex items-center justify-center mx-auto" style="clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);">
                            <i data-feather="bar-chart-2" class="w-4 h-4 text-white"></i>
                        </div>
                        <p class="text-xs text-green-400" style="font-family: 'Press Start 2P', monospace; font-size: 6px;">LEVEL UP</p>
                    </div>
                    <div class="space-y-2">
                        <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-green-600 border-2 border-green-400 flex items-center justify-center mx-auto" style="clip-path: polygon(50% 0%, 0% 100%, 100% 100%);">
                            <i data-feather="users" class="w-4 h-4 text-white"></i>
                        </div>
                        <p class="text-xs text-green-400" style="font-family: 'Press Start 2P', monospace; font-size: 6px;">GUILD</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Back to Home -->
        <div class="text-center mt-6" data-aos="fade-up" data-aos-delay="400">
            <a href="index.html" class="text-green-400 hover:text-green-300 text-sm transition-colors duration-300 flex items-center justify-center" style="font-family: 'Press Start 2P', monospace; font-size: 10px;">
                <i data-feather="arrow-left" class="w-4 h-4 mr-2"></i>
                🏠 RETURN TO VILLAGE
            </a>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="glass-effect rounded-2xl p-8 text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
            <p class="text-white">Signing you in...</p>
        </div>
    </div>

    <script>
        // Initialize AOS and Feather icons
        AOS.init({
            duration: 800,
            once: true
        });
        feather.replace();

        // Google OAuth Configuration
        const GOOGLE_CLIENT_ID = '880790160266-nheta7vamr068cs7u4rm5upimu176l5t.apps.googleusercontent.com';

        // Initialize Google Sign-In
        function initializeGoogleSignIn() {
            if (typeof google !== 'undefined' && google.accounts) {
                google.accounts.id.initialize({
                    client_id: GOOGLE_CLIENT_ID,
                    callback: handleCredentialResponse,
                    auto_select: false,
                    cancel_on_tap_outside: true
                });
            }
        }

        // Handle Google Sign-In
        function signInWithGoogle() {
            showLoading();
            console.log('Google sign-in clicked');
            
            // Check if Google API is loaded
            if (typeof google !== 'undefined' && google.accounts && google.accounts.id) {
                try {
                    console.log('Google API loaded, starting OAuth...');
                    // Use the One Tap API
                    google.accounts.id.prompt((notification) => {
                        console.log('Google prompt notification:', notification);
                        if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
                            console.log('Google prompt not displayed, using fallback');
                            setTimeout(() => {
                                simulateGoogleSignIn();
                            }, 1000);
                        }
                    });
                } catch (error) {
                    console.error('Google OAuth error:', error);
                    setTimeout(() => {
                        simulateGoogleSignIn();
                    }, 1000);
                }
            } else {
                console.log('Google API not loaded, using demo mode');
                setTimeout(() => {
                    simulateGoogleSignIn();
                }, 1000);
            }
        }

        // Simulate Google Sign-In (Replace with actual implementation)
        function simulateGoogleSignIn() {
            // Simulate user data that would come from Google
            const userData = {
                name: 'John Doe',
                email: 'john.doe@gmail.com',
                picture: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face',
                verified_email: true
            };

            // Store user data in localStorage
            localStorage.setItem('userName', userData.name);
            localStorage.setItem('userEmail', userData.email);
            localStorage.setItem('userPicture', userData.picture);
            localStorage.setItem('isSignedIn', 'true');
            localStorage.setItem('profileName', userData.name);
            localStorage.setItem('profileAvatar', userData.picture);

            hideLoading();
            
            // Show success message
            showSuccessMessage();
            
            // Redirect to home page after a short delay
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 2000);
        }

        // Test Google Sign-In (bypasses OAuth)
        function testGoogleSignIn() {
            showLoading();
            console.log('Testing Google sign-in...');
            
            // Simulate Google sign-in immediately
            setTimeout(() => {
                simulateGoogleSignIn();
            }, 1500);
        }

        // Open Google OAuth in popup
        function openGooglePopup() {
            showLoading();
            console.log('Opening Google OAuth popup...');
            
            const popup = window.open(
                'https://accounts.google.com/oauth/authorize?client_id=880790160266-nheta7vamr068cs7u4rm5upimu176l5t.apps.googleusercontent.com&redirect_uri=http://127.0.0.1:3001/signin.html&response_type=code&scope=openid%20email%20profile',
                'googleSignIn',
                'width=500,height=600,scrollbars=yes,resizable=yes'
            );
            
            // Check if popup was blocked
            if (!popup || popup.closed || typeof popup.closed == 'undefined') {
                hideLoading();
                alert('Popup blocked! Please allow popups for this site and try again.');
                return;
            }
            
            // For demo purposes, simulate successful sign-in after 3 seconds
            setTimeout(() => {
                popup.close();
                simulateGoogleSignIn();
            }, 3000);
        }

        // Guest sign-in
        function signInAsGuest() {
            showLoading();
            
            setTimeout(() => {
                localStorage.setItem('isSignedIn', 'false');
                localStorage.setItem('profileName', 'Guest User');
                localStorage.setItem('profileAvatar', 'http://static.photos/people/200x200/1');
                localStorage.setItem('profileTitle', 'Hygiene Explorer');
                localStorage.setItem('profileBio', 'I\'m passionate about learning and maintaining good hygiene practices to stay healthy!');
                
                hideLoading();
                showSuccessMessage('Welcome, Guest! Setting up your profile...');
                
                setTimeout(() => {
                    window.location.href = 'profile.html';
                }, 2000);
            }, 1000);
        }

        // Show loading overlay
        function showLoading() {
            document.getElementById('loading-overlay').classList.remove('hidden');
            document.getElementById('loading-overlay').classList.add('flex');
        }

        // Hide loading overlay
        function hideLoading() {
            document.getElementById('loading-overlay').classList.add('hidden');
            document.getElementById('loading-overlay').classList.remove('flex');
        }

        // Show success message
        function showSuccessMessage(message = 'Welcome to EcoLearn!') {
            const overlay = document.getElementById('loading-overlay');
            overlay.innerHTML = `
                <div class="glass-effect rounded-2xl p-8 text-center">
                    <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i data-feather="check" class="w-8 h-8 text-white"></i>
                    </div>
                    <p class="text-white text-lg font-medium">${message}</p>
                    <p class="text-gray-300 text-sm mt-2">Redirecting...</p>
                </div>
            `;
            feather.replace();
        }

        // Handle credential response (for actual Google OAuth)
        function handleCredentialResponse(response) {
            // Decode the JWT token to get user information
            const responsePayload = decodeJwtResponse(response.credential);
            
            const userData = {
                name: responsePayload.name,
                email: responsePayload.email,
                picture: responsePayload.picture,
                verified_email: responsePayload.email_verified
            };

            // Store user data
            localStorage.setItem('userName', userData.name);
            localStorage.setItem('userEmail', userData.email);
            localStorage.setItem('userPicture', userData.picture);
            localStorage.setItem('isSignedIn', 'true');
            localStorage.setItem('profileName', userData.name);
            localStorage.setItem('profileAvatar', userData.picture);

            hideLoading();
            showSuccessMessage();
            
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 2000);
        }

        // Decode JWT response (helper function)
        function decodeJwtResponse(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing Google Sign-In...');
            initializeGoogleSignIn();
            
            // Add button event listeners
            const googleBtn = document.getElementById('google-signin-btn');
            if (googleBtn) {
                googleBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Google sign-in button clicked');
                    signInWithGoogle();
                });
            }
            
            console.log('Event listeners attached');
        });

        // Add some interactive effects
        document.getElementById('google-signin-btn').addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
        });

        document.getElementById('google-signin-btn').addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    </script>
</body>
</html>
